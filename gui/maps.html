<html><head><script>navigator.geolocation.getCurrentPosition(function(position) {      				// start of code from https://stackoverflow.com/questions/7463367/how-to-call-function-when-user-allows-or-denies-access-to-physical-location   alert('allow');}, function() {    alert('deny');	});																						// end of code from https://stackoverflow.com/questions/7463367/how-to-call-function-when-user-allows-or-denies-access-to-physical-location</script></head><body><!-- <div id="header">    <div class='container' style="width: 100%;" >WIFI SCANNER</div></div>	<div id="map" style="width: 100%; height: 70%;">	</div>  <div id ="Scan" style = "width: 50%; float: left;">		<p id="Scan">Click the button to scan for WI-FI</p>		<button onclick="ScanWifi()">Start Scan</button>  <button onclick="StopScan()">StopScan</button>	<button onclick="clearMarkers()">Clear Markers</button>  </div>  <div id="scanner" style="width: 50%; float: left;">	<p id="MAC">Scan Results:</p>	</div>    <div id="MAC_Search" style="width: 50%; float: left;";>		<p id="MAC">Enter MAC address to search for its maker - (AA:BB:CC:DD:EE:FF format)</p>		MAC Address: <input type="text" id="myText" value="">		<button onclick="MAC_Search()">Try it</button>	</div>	<div id="MAC_Result" style="width: 50%; float: left;";></div> --><style>.map { grid-area: header; }.scanner { grid-area: menu; }.scan { grid-area: main; }.MAC_Search { grid-area: right; }.MAC_Result { grid-area: footer; }.grid-container {  display: grid;  grid-template-areas:    'header header header header header header'	'header header header header header header'	'header header header header header header'    'menu menu menu right right right'    'main main main footer footer footer';  grid-gap: 5px;  background-color: #53616f;  padding: 1%;}.grid-container > div {  background-color: #c9cbc8;  text-align: center;  padding: 5% 0;  color: #76bced;  font-size: 20px;}</style></head><body><h1>Wifi Scanner</h1><div id="map" style="width: 100%; height: 60%;"></div> <div class="grid-container">  <div class="scanner">Scanner  	<p id="Scan">Click the button to scan for WI-FI</p>  	<button onclick="ScanWifi()">Start Scan</button>     <button onclick="StopScan()">StopScan</button>    <button onclick="clearMarkers()">Clear Markers</button>  </div>  <div class="scan">Scan Result  </div>    <div class="MAC_Search">MAC    <p id="MAC">Enter MAC address to search for its maker - (AA:BB:CC:DD:EE:FF format)</p>	MAC Address: <input type="text" id="myText" value="">	<button onclick="MAC_Search()">Try it</button>  </div>  <div class="MAC_Result">MAC RESULT  </div></div>   <!-- <button class="btn btn-info"><a style="color:black" href="gui.html">< Back</a></button> -->   <!-- <h2>Scanner Info</h2> -->	<!-- <p id="Scan">Click the button to scan for WI-FI</p> -->	 <!-- <button onclick="ScanWifi()">Start Scan</button>  <button onclick="StopScan()">StopScan</button>	<button onclick="clearMarkers()">Clear Markers</button> -->		<!-- <div id="scanner" style="width: 50%; height: 30%;"> -->            <script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script><script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxFzWNiEgeRdr51Y6al3U9XiZ6yjYlxbE&callback=initMap" async defer></script><script async defer>	var TestInfo = [];	var Long;	var Lat;	var map;	var marker;	var MarkersArray = [];	var indexNum	var SignalMarked	var gmarkers = [];	var iconBase = '/home/pi/Desktop/PI_App/gui/Icons/';   // location of files used to create custom markers - sourced from https://developers.google.com/maps/documentation/javascript/custom-markers   // var MACs = [];	var locations = [	    ['Road 1', 53.760020, -2.707116, 4],	];		var Manufacturer;	var Manufacturers = [];	var log4js = require('log4js');  									// source - https://github.com/log4js-node/log4js-node  https://stackoverflow.com/questions/41232578/node-js-console-log-in-txt-file 	log4js.configure({																			// ^^ Used to log things to a file, rather than to the console. I have an error that crashes my program and therefore I cant see the console...so this helps -->	appenders: {		out:{ type: 'console' },		app:{ type: 'file', filename: '/home/pi/Desktop/PI_App/gui/Crashes.log' }		},	categories: {		default: { appenders: [ 'out', 'app' ], level: 'debug' }		}	});	var logger = log4js.getLogger();	const SerialPort = require("serialport");	const GPS = require("gps");	const Readline = require("@serialport/parser-readline");	const gpsInfo = {};	const port = new SerialPort("/dev/ttyAMA0");	const parser = port.pipe(new Readline({ delimiter: "\n" }));	const gps = new GPS();		gps.on("data", function(data) {		try {		   if (data.type === "GGA") {			 gpsInfo.lat = data.lat || gpsInfo.lat;			 gpsInfo.lon = data.lon || gpsInfo.lon;			 gpsInfo.speed = data.speed || gpsInfo.speed;			 gpsInfo.time = data.time.toString() || gpsInfo.time;			 Long = gpsInfo.lon			 Lat = gpsInfo.lat 		//	 logger.debug("LONG : " + Long)			// logger.debug("LAT : " + Lat)			}		} catch (e) {			logger.debug(			 "Exception raised while getting data from GPS",			 JSON.stringify(e)			);		}	});	parser.on("data", function(data) {		try {			gps.update(data);		} catch (e) {			logger.debug(			 "Exception raised while getting data from Serialport parser",			 JSON.stringify(e)			);		}	});	function initMap() {			myLat = Lat		myLong = Long		//	logger.debug("Lat: " + myLat) 	//	logger.debug("Long: " + myLong)   										<!-- start of code from https://www.youtube.com/watch?v=xJubVipcHrM&t=186s -->		x = navigator.geolocation;		x.getCurrentPosition(success, failure);			function success(position){				var coords = new google.maps.LatLng(myLat,myLong);				var mapOptions = {					zoom:20,					center: coords,					mapTypeId: google.maps.MapTypeId.HYBRID   					<!-- 4 map options, ROADMAP, SATELITE, HYBRID, TERRAIN r-->				}				map = new google.maps.Map(document.getElementById("map"), mapOptions);				marker = new google.maps.Marker({map:map, position:coords, icon: iconBase + 'PersonIcon.png'});					//setMarkers()				updateMap(); // updated the map with users location, moving the marker as the user changes location			} 			function failure(){ 				logger.debug("Maps failed")			}	}// close function here	 <! End of code from https://www.youtube.com/watch?v=xJubVipcHrM&t=186s -->				function updateMap() {		myLat = Lat		myLong = Long		//logger.debug(myLat + " " + myLong)		UserWindow = new google.maps.InfoWindow({		});		var newLatLng = new google.maps.LatLng(myLat,myLong);		marker.setPosition(newLatLng);	 // infowindow.setPosition(marker.getPosition());		//setMarkers();		google.maps.event.addListener(marker, 'click', (function(marker) {			return function() {				UserWindow.setContent(myLat + ', ' + myLong);				UserWindow.open(map, marker);				}		})(marker));		setTimeout(updateMap, 2000);             //recusively run the function every 2 seconds. This way the map is updating the marker to my location every 2 seconds .	};   </script>   <!-- <div id="map" style="width: 100%; height: 70%;"></div> --><script>	var WifiObject = [];	var object1 = [];	var cancel = 0;											// creates global variable that is used to check if the stop button is clicked	var arrayLength;	var counter = 0;	var ArrayExists;	//var Signals = {};	var NetworkArray = [];	var scanCounter = 0					// Used to point to longitude and latitude values at the correct point	var LongArray = [];                                  // Used to store Longitutes in an array	var LatArray = [];                                    // Used to store Latitudes in an array	var SignalIndex	var marker	var Numbers = [];	var Names = [];	var Lats = [];	var Longs = [];    var NetNum;	var NameNum	var LatNum	var LongNum	var DataWindow	function StopScan() {										// sets cancel to 1 if Stop is clicked		cancel = 1	}	function ScanWifi() {	logger.debug(cancel)	const scanner = require('node-wifi-scanner');   																// start of code from https://www.npmjs.com/package/node-wifi-scanner 	scanner.scan((err, networks) => {		if (err) {			console.error(err);			return;		}		//logger.debug(networks);  // displays all WIFI 																// end of code from https://www.npmjs.com/package/node-wifi-scanner 																													// Passes the networks array to the SignalsData function		var nets = [];																								// creation of new array to hold data we want to use from the networks array		arrayLength = networks.length																				// loops through the network array, pulling out and displaying the SSID for each network inside the console		for (var i = 0; i < arrayLength; i++) {			console.log(networks[i].mac)			nets[i] = "SSID: " + networks[i].ssid + " - " + networks[i].mac + " - " + "Signal strength" + networks[i].rssi +  " - " + '<br />';    			document.getElementsByClassName("scan")[0].innerHTML=nets														// updates the part of the HTML after the Scanner header, with the text from the Nets array created. Lists the SSID and RSSI of scanned networks		}		if (cancel == 0) {																							// if cancel value is 0, the stop button hasnt been clicked, so continue to loop every second			SignalData(networks)				//ScanWifi()			setTimeout(ScanWifi, 5000);   																			// Repeats the Scan function every 1000 miliseconds (1 second)  		}		if (cancel == 1) {																							// Resets the state of the scanner function, so if the start button is clicked the stop button doesnt overwrite its loop function			cancel = 0 																									// The stop button has been clicked, stopping the loop. To allow the loop to function correctly if the start button is pressed, the value is reset.		}    })};</script><script>async function SignalData(arr) {							//passes the networks array into this method. arr tells the function that the parameter passed is an array	logger.debug("LAT: "  + Lat) 	logger.debug("LONG: " + Long) 	if(Long == null || Long == "NaN"){		logger.debug("LONG invalid")	}	else{		logger.debug("LONG PUSHED")		LongArray = [] //clears the array		LongArray.push(Long)	}	if(Lat == null || Lat == "NaN"){		logger.debug("LAT invalid")	}	else{		logger.debug("LAT PUSHED")		LatArray = []  //clears the array		LatArray.push(Lat) 	}	if (counter == 0) {							// Checks to see if the Signals array already exists or is empty		ArrayExists = false;	}	if (counter > 0) {		ArrayExists = true;	}	if (ArrayExists == false) {						// Creates a object for each Network found, The objects are names using the network names		for (var i = 0; i < arr.length; i++) {					//Manufacturer[i] = Manufacturer				SSID = arr[i].ssid + "_" + arr[i].mac				//MAC_LOOKUP(arr[i].mac)				//Maker = MAC_LOOKUP(arr[i].mac)				//console.log("Maker" + Maker)				object1[i] ={					number: [i],					//assigns a number to each network found					name: SSID,					mac: arr[i].mac,					//manufacturer: MACs[i],					RSSI: [ arr[i].rssi ],					Longitude: [ LongArray[LongArray.length-1] ],					Latitude: [ LatArray[LatArray.length-1] ] 				};					}	}	if (ArrayExists == true) {			for (var i = 0; i < arr.length; i++) {				networkToMatch = arr[i].ssid + "_" + arr[i].mac				// Combines the MAC address and SSID to create a unique identifier for each Access point			//logger.debug(networkToMatch)								let result = object1.filter(obj => {					//https://stackoverflow.com/questions/13964155/get-javascript-object-from-array-of-objects-by-value-of-property elclanrs insipred this snippet				return obj.name == networkToMatch				//searches all objects created for one that matches the signal data recived from netscan			})			logger.debug(JSON.stringify(result))																							//checks if the wifi network is already stored			if (result == null || result == "" || result == []) {							//Issue with this loop (loops contstantly, broken.)																			// should create objects as new wifi signals are found				logger.debug("NULL OBJECT")				logger.debug("ARRAY LEN" + arr.length)				logger.debug(JSON.stringify(arr))				//for (var i = 0; i < arr.length; i++) {				SSID = arr[i].ssid + "_" + arr[i].mac				//Maker = MAC_LOOKUP(arr[i].mac)								//console.log("Maker" + Maker)				logger.debug(SSID)				//LongArray.push(myLong);				//LatArray.push(myLat);				object1[i] ={					number: [i],					//assigns a number to each network found					name: SSID,					mac: [ arr[i].mac ],					//manufacturer: MACs[i],					RSSI: [ arr[i].rssi ],					Longitude: [ LongArray[LongArray.length-1] ],					Latitude: [ LatArray[LatArray.length-1] ]				};				logger.debug(JSON.stringify(object1[i]))			} else {				logger.debug("NET FOUND" + JSON.stringify(result))			}			//logger.debug(object1)								//logger.debug("OUTER LOOP RESULT " + result)			if (result[0] == "undefined"){			// checks if the network number is null				logger.debug("network not scanned")			} else if (typeof result[0] !== "undefined"){				NetworkNumber = result[0].number						// grabs the unique network number 				//logger.debug(result[0].number)							// end of snippet				object1[NetworkNumber].RSSI.push(arr[i].rssi)					//find the object related to the SSID we searched for, then pushed the RSSI for this network to the RSSI array inside this object				object1[NetworkNumber].Longitude.push(LongArray[LongArray.length-1])				object1[NetworkNumber].Latitude.push(LatArray[LatArray.length-1])				}			if (object1[NetworkNumber].RSSI.length >= 5) {				var LastRssi = object1[NetworkNumber].RSSI.slice(object1[NetworkNumber].RSSI.length - 5, object1[NetworkNumber].RSSI.length)				//logger.debug(LastRssi)				var RssiValue = true			}			if (object1[NetworkNumber].Longitude.length >= 5){				var LastLong = object1[NetworkNumber].Longitude.slice(object1[NetworkNumber].Longitude.length - 5, object1[NetworkNumber].Longitude.length)				//logger.debug(LastLong)				var LongValue = true			}			if (object1[NetworkNumber].Latitude.length >= 5){				var LastLat = object1[NetworkNumber].Latitude.slice(object1[NetworkNumber].Latitude.length - 5, object1[NetworkNumber].Latitude.length)				//logger.debug(LastLat)				var LatValue = true;			}		 			if (RssiValue == true && LongValue == true && LatValue == true){				//logger.debug("NETWORK ARRAY" + NetworkArray)                     				var Weight1 = Math.pow(parseFloat(LastRssi[0]), 2) / (Math.pow(parseFloat(LastRssi[0]), 2) + Math.pow(parseFloat(LastRssi[1]), 2) + Math.pow(parseFloat(LastRssi[2]), 2)  + Math.pow(parseFloat(LastRssi[3]), 2) +  + Math.pow(parseFloat(LastRssi[4]), 2))				//logger.debug("WEIGHT = " + Weight1)				var Weight2 = Math.pow(parseFloat(LastRssi[1]), 2) / (Math.pow(parseFloat(LastRssi[0]), 2) + Math.pow(parseFloat(LastRssi[1]), 2) + Math.pow(parseFloat(LastRssi[2]), 2)  + Math.pow(parseFloat(LastRssi[3]), 2) +  + Math.pow(parseFloat(LastRssi[4]), 2))				//logger.debug("WEIGHT2 = " + Weight2)				var Weight3 = Math.pow(parseFloat(LastRssi[2]), 2) / (Math.pow(parseFloat(LastRssi[0]), 2) + Math.pow(parseFloat(LastRssi[1]), 2) + Math.pow(parseFloat(LastRssi[2]), 2)  + Math.pow(parseFloat(LastRssi[3]), 2) +  + Math.pow(parseFloat(LastRssi[4]), 2))				//logger.debug("WEIGHT3 = " + Weight3)								var Weight4 = Math.pow(parseFloat(LastRssi[3]), 2) / (Math.pow(parseFloat(LastRssi[0]), 2) + Math.pow(parseFloat(LastRssi[1]), 2) + Math.pow(parseFloat(LastRssi[2]), 2)  + Math.pow(parseFloat(LastRssi[3]), 2) +  + Math.pow(parseFloat(LastRssi[4]), 2))				//logger.debug("WEIGHT4 = " + Weight4)								var Weight5 = Math.pow(parseFloat(LastRssi[4]), 2) / (Math.pow(parseFloat(LastRssi[0]), 2) + Math.pow(parseFloat(LastRssi[1]), 2) + Math.pow(parseFloat(LastRssi[2]), 2)  + Math.pow(parseFloat(LastRssi[3]), 2) +  + Math.pow(parseFloat(LastRssi[4]), 2))				//logger.debug("WEIGHT5 = " + Weight5)								EstLong = (LastLong[0] * Weight1) + (LastLong[1] * Weight2) + (LastLong[2] * Weight3) + (LastLong[3] * Weight4) + (LastLong[4] * Weight5)				EstLat = (LastLat[0] * Weight1) + (LastLat[1] * Weight2) + (LastLat[2] * Weight3) + (LastLat[3] * Weight4) + (LastLat[4] * Weight5)				//logger.debug("EST LAT LONG" + EstLat + EstLong)				EstLatLng = new google.maps.LatLng(EstLat, EstLong);				//logger.debug("EstLatLng" + EstLatLng)      				indexNum = Names.indexOf(object1[NetworkNumber].name)								for (var i = 0; i < locations.length; i++) {				  if (locations[i][1] == object1[NetworkNumber].name) {					logger.debug("LOCATIONS BEFORE: ")					logger.debug(JSON.stringify(locations))					locations.splice(i, 1);					logger.debug("LOCATIONS AFTER: ")					logger.debug(JSON.stringify(locations))				  }				}								//MAC_LOOKUP(object1[NetworkNumber].mac);	// calls the method that searches IEEE database for MAC address manufacturer					var TempArr = [NetworkNumber, object1[NetworkNumber].name, EstLat, EstLong, object1[NetworkNumber].manufacturer]				locations.push(TempArr)				logger.debug(object1[NetworkNumber].name +  "POS: " + EstLat + " , " + EstLong + " 		mac: "  + object1[NetworkNumber].manufacturer)								//logger.debug("Locations")				//logger.debug(locations)   			}  					}  	}	//logger.debug(object1)		counter = counter + 1	scanCounter ++	logger.debug("SCAN COUNTER: " + scanCounter)	//logger.debug("Locations")	//logger.debug(locations)		clearMarkers();	setMarkers();} function MAC_LOOKUP(MAC){var RawMAC = MACvar fullMAC =  RawMAC.replace(/:+/g, '');		// line inspired by https://stackoverflow.com/questions/26419590/replace-multiple-semicolon-to-single-one-in-javascriptconsole.log ("FULL MAC: " + fullMAC)var MAC = fullMAC.substring(0,6)console.log(MAC)const fs = require('fs');const Papa = require('papaparse');const file = fs.createReadStream('/home/pi/Desktop/PI_App/gui/MACs.csv');//Function adapted from source - https://stackoverflow.com/questions/49752889/how-can-i-read-a-local-file-with-papa-parse	user Philip M.	Papa.parse(file, {	header:true,		complete: function(results) {			for (var i = 0; i < results.data.length; i++){				//console.log(results.data[i])				if (results.data[i].Assignment == MAC){					//console.log("FOUND")					//console.log(results.data[i].Organization)					Manufacturer = results.data[i].Organization					return Manufacturer				}			}				//console.log(results.data.length)			//console.log(results);		}	});	}function clearMarkers(){	for (i = 0; i < gmarkers.length; i++) {  		gmarkers[i].setMap(null)	}}function setMarkers() {			//function inspired by https://stackoverflow.com/questions/15531390/adding-array-of-markers-in-google-map 	for (i = 0; i < locations.length; i++) {  				DataWindow = new google.maps.InfoWindow({		});		var Wifimarker = new google.maps.Marker({			position: new google.maps.LatLng(locations[i][2], locations[i][3]),			map: map,			title: toString(locations[i][1])			//icon: iconBase + 'WifiIcon.png'		});		gmarkers.push(Wifimarker);		google.maps.event.addListener(Wifimarker, 'click', (function(Wifimarker, i) {			return function() {				DataWindow.setContent("<p>" + locations[i][1] + "<br />"  + "Latitude: " + locations[i][2] + "<br />"  + "Longitude: " +locations[i][3] +  "<br />"  +   "</p>");			//Inspired by Jason Gennaro https://stackoverflow.com/questions/6737042/google-maps-v3-formatting-multiple-lines-of-content-in-infowindow				DataWindow.open(map, Wifimarker);			}		})(Wifimarker, i));	//	TestInfo[i] = "MARKER: " + locations[i][1] + "   GPS: " + locations[i][2] + " " + locations[i][3] + '<br />';    	//	document.getElementById("markerLoc").innerHTML=TestInfo												// updates the part of the HTML after the Scanner header, with the text from the Nets array created. Lists the SSID and RSSI of scanned networks	}	<!-- var markerCluster = new MarkerClusterer(map, gmarkers, -->		<!-- {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'}); -->}</script><!-- <p id="MAC">Enter MAC address to search for its maker - (AA:BB:CC:DD:EE:FF format)</p> -->	<!-- MAC Address: <input type="text" id="myText" value=""> -->	<!-- <button onclick="MAC_Search()">Try it</button> -->		<!-- <div id="MAC_Search" style="width: 50%; height: 30%;"> --><script>function MAC_Search(){	var rawMAC = document.getElementById("myText").value;	var fullMAC = rawMAC.replace(/:+/g, '');	var MAC = fullMAC.substring(0,6);	console.log(MAC)	const fs = require('fs');	const Papa = require('papaparse');	const file = fs.createReadStream('/home/pi/Desktop/PI_App/gui/MACs.csv');	//Function adapted from source - https://stackoverflow.com/questions/49752889/how-can-i-read-a-local-file-with-papa-parse	user Philip M.	Papa.parse(file, {	header:true,	complete: function(results) {		for (var i = 0; i < results.data.length; i++){			//console.log(results.data[i])			if (results.data[i].Assignment == MAC){				console.log("FOUND")				Answer = results.data[i].Organization				console.log(Answer)				document.getElementsByClassName("MAC_Result")[0].innerHTML = Answer;			}		}	}			//console.log(results.data.length)		//console.log(results);	});}</script>